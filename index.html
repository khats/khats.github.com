<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
      var googleUser = {};
      var startApp = function() {
          gapi.load('client:auth2', function(){
              // Retrieve the singleton for the GoogleAuth library and set up the client.
              gapi.client.init({
                  clientId: '474337288501-i7fvto28sctjqbk1cqslqfamhtp5s6fv.apps.googleusercontent.com',
                  cookiepolicy: 'single_host_origin',
                  // Request scopes in addition to 'profile' and 'email'
                  scope: 'profile email https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.me'})
                  .then(function(){
                      var auth2 = gapi.auth2.getAuthInstance();
                      attachSignin(auth2, document.getElementById('customBtn'));

                      auth2.isSignedIn.listen(function(val){
                          console.log('listener isSignedIn', val);
                          document.getElementById('sign-in-status').textContent = val;
                          if(auth2.isSignedIn.get() == true){
                              console.log('listener isSignedIn, already signined, token:', auth2.currentUser.get().getAuthResponse().id_token);
                              gapi.client.load('plus','v1', function(){
                                  var request = gapi.client.plus.people.get({
                                      'userId': 'me'
                                  });
                                  request.execute(function(resp) {
                                      console.log('Retrieved profile for:' + JSON.stringify(resp));
                                  });
                              });
                          }
                      });
                      auth2.currentUser.listen(function(user){
                          console.log('user changed', user.getId());
                      });

                      // Sign in the user if they are currently signed in.
                      if (gapi.auth2.getAuthInstance().isSignedIn.get() == true) {
                          console.log('hot start sign in');
                          gapi.client.load('plus','v1', function(){
                              var request = gapi.client.plus.people.get({
                                  'userId': 'me'
                              });
                              request.execute(function(resp) {
                                  console.log('Retrieved profile for:' + JSON.stringify(resp));
                              });
                          });
                          /*auth2.signIn();*/
                      }

                      document.getElementById('google-logout').onclick = function(){
                          auth2.signOut().then(function(){
                              console.log('sign out');
                              document.getElementById('sign-in-status').textContent = 'manual sign out';
                          });
                      }
                  });


          });
      };

      function attachSignin(auth2, element) {
          console.log(element.id);
          auth2.attachClickHandler(element, {},
              function(googleUser) {
                  document.getElementById('name').innerText = "Signed in: " +
                      googleUser.getBasicProfile().getName();
              }, function(error) {
                  alert(JSON.stringify(error, undefined, 2));
              });
      }
  </script>
  <style type="text/css">
    #customBtn {
      background:url('btn_google_signin_dark_normal_web.png') no-repeat;
      display: inline-block;
      width: 191px;
      height:46px;
    }
  </style>
  <title>Title</title>
</head>
<body>
<a  href="https://www.dating.local:3000/people/#token=70a0ed02-09fb-44c2-8eb8-35bfaa547590&emit=command.email.track,100,confirmed,,offline-letter">1111</a>
<div class="google-button">
  <div id="gSignInWrapper">
    <span class="label">Sign in with:</span>
    <div id="customBtn">
    </div>
  </div>
  <div id="name"></div>
  <script>startApp();</script>
  <div>
    <span>Sign in status:</span>
    <span id="sign-in-status"></span>
  </div>
  <button id="google-logout">logout</button>
</div>
</body>
</html>
