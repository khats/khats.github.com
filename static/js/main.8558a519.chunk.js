(this.webpackJsonpminesweeper=this.webpackJsonpminesweeper||[]).push([[0],{14:function(e,t,n){e.exports={makeDecision:"styles_makeDecision__1hwdq"}},15:function(e,t,n){e.exports=n(22)},22:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(12),i=n.n(o),s=n(1),c=n(2),l=n(4),u=n(3),p=n(5),f=n(10);function h(e){return r.a.createElement("div",null,"Dev mode:",r.a.createElement("div",null,r.a.createElement("span",null,"Use random decisions")," ",r.a.createElement("input",{type:"checkbox",onChange:e.useAutobot,checked:e.autobotEnabled})),r.a.createElement("div",null,r.a.createElement("span",null,"Stop autobot on unopened cells %: ")," ",r.a.createElement("input",{type:"number",onChange:e.setAutobotPercent,value:e.autobotStopPercent,min:0,max:100})))}function m(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"You lose"),r.a.createElement("button",{onClick:e.restartGame},"Restart"))}var E=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).changeLevel=function(e){var t=e.target.value;if(/^[1-9]*$/.test(t)){var a=parseInt(t);n.setState({level:isNaN(a)?"":a})}},n.useAutobot=function(e){n.setState({autobotEnabled:e.target.checked})},n.setAutobotPercent=function(e){n.setState({autobotStopPercent:e.target.value})},n.startGame=function(){n.props.startGame(n.state.level,n.state.autobotEnabled,n.state.autobotStopPercent)},n.state={level:1,autobotEnabled:!1,autobotStopPercent:0},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.loose?r.a.createElement(m,{restartGame:this.props.restartGame}):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Select level:"),r.a.createElement("input",{type:"text",placeholder:"1,2,3,4 or other",onChange:this.changeLevel,value:this.state.level}),this.state.level?r.a.createElement("button",{onClick:this.startGame},"Start"):null,r.a.createElement(h,{useAutobot:this.useAutobot,setAutobotPercent:this.setAutobotPercent,autobotEnabled:this.state.autobotEnabled,autobotStopPercent:this.state.autobotStopPercent})))}}]),t}(a.PureComponent),d=n(8),v=n.n(d),b=n(9),g=n.n(b),N=n(6),O=n(7),j=n.n(O),y=n(13),w=n.n(y),S=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).open=function(){n.props.open(n.props.i,n.props.j)},n.setFlag=function(e){e.preventDefault(),n.props.setFlag(n.props.i,n.props.j)},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e,t=w()((e={},Object(N.a)(e,j.a.cell,!0),Object(N.a)(e,j.a.safe,this.props.value>=0),Object(N.a)(e,j.a.flag,-1===this.props.value),Object(N.a)(e,j.a.mine,-2===this.props.value),e));return r.a.createElement("span",{className:t,onClick:this.open,onContextMenu:this.setFlag},this.props.value)}}]),t}(r.a.PureComponent);S.displayName="Cell";var _=S,k=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).open=function(e,t){n.props.open(t,e)},n.setFlag=function(e,t){n.props.setFlag(e,t)},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.matrix;return r.a.createElement("div",{className:g.a.desk},t.map((function(t,n){return r.a.createElement("div",{key:n,className:g.a.row},t.map((function(t,a){return r.a.createElement(_,{value:t,key:a,i:n,j:a,open:e.open,setFlag:e.setFlag})})))})))}}]),t}(r.a.PureComponent);k.displayName="Desk",k.propType={matrix:v.a.arrayOf(v.a.arrayOf(v.a.number))};var x=k,A=function(e){return"new ".concat(e)},F="map",P=function(e,t){return"open ".concat(e," ").concat(t)},C=function(){function e(t,n){Object(s.a)(this,e),this.connection=new WebSocket(t),this.connection.addEventListener("message",(function(e){var t=e.data.split(":"),a=t.splice(0,1)[0];n(a,t.join(":").trim())})),this.connection.addEventListener("open",(function(){n("new","connected")}))}return Object(c.a)(e,[{key:"createGame",value:function(e){this.connection.send(A(e))}},{key:"getMap",value:function(){this.connection.send(F)}},{key:"openCell",value:function(e,t){this.connection.send(P(e,t))}}]),e}(),G={NEW:"new",MAP:"map",OPEN:"open"},L={CONNECTED:"connected",OK:"OK",LOSE:"You lose",WIN:"You win"};function M(e){return e.password?r.a.createElement("div",null,e.password):null}function I(e){return r.a.createElement("div",null,r.a.createElement("span",null,"Mines:"),r.a.createElement("span",null,e.minesCount))}var R=n(14),q=n.n(R);function D(e){return r.a.createElement(r.a.Fragment,null,e.helpRequired?r.a.createElement("h3",{className:q.a.makeDecision},"Open cell, please! (Can not make decision)"):null)}var T=[{i:-1,j:-1},{i:-1,j:0},{i:-1,j:1},{i:0,j:1},{i:1,j:1},{i:1,j:0},{i:1,j:-1},{i:0,j:-1}];function W(e,t,n,a){var r,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=[];return T.forEach((function(s){(r=function(e,t,n,a,r){if(t<0||n<0||t>=e.length||n>=e[t].length)return null;var o=e[t][n];return!a&&isNaN(o)||!isNaN(o)&&(r?o===a:o>=a)?{row:t,cell:n}:null}(e,t+s.i,n+s.j,a,o))&&i.push(r)})),i}var U={FLAG:-1,MINE:-2,REAL_MINE:"*",SAFE_TO_OPEN:-3},Y=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).resolver=function(e,t){if(e===G.NEW){if(t===L.CONNECTED)return void n.setState({connected:!0});if(t===L.OK)return void n.setState({started:!0,matrix:[],helpRequired:!1},(function(){n.state.connection.getMap()}))}if(e===G.MAP){var a=t.split("\n").filter((function(e){return""!==e})).map((function(e){return e.split("")}));return n.state.matrix===a.length&&a.forEach((function(e,t){e.forEach((function(e,r){isNaN(e)&&(a[t][r]=n.state.matrix[t][r])}))})),void n.setState({matrix:a,helpRequired:!1})}if(e===G.OPEN){if(t===L.LOSE)return void n.setState({started:!1});t.startsWith(L.WIN)&&n.setState({password:t,matrix:[],started:!1})}},n.restartGame=function(){n.setState({matrix:[],started:!1,helpRequired:!1,password:null})},n.startGame=function(e,t,a){n.setState({autobotEnabled:t,autobotStopPercent:a}),n.state.connection.createGame(e)},n.open=function(e,t){n.state.connection.openCell(e,t),n.state.connection.getMap()},n.openList=function(e){e.forEach((function(e){n.state.connection.openCell(e.cell,e.row)})),n.state.connection.getMap()},n.setFlag=function(e,t){var a=n.state.matrix.map((function(e){return Object(f.a)(e)}));a[e][t]=U.FLAG,n.setState({matrix:a})},n.step=function(){var e=[];if(n.state.matrix.forEach((function(t,n){t.forEach((function(t,a){t===U.SAFE_TO_OPEN&&e.push({row:n,cell:a})}))})),e.length)n.openList(e);else{var t=function(e){var t=e.map((function(e){return Object(f.a)(e)}));return t.forEach((function(e,n){return e.forEach((function(e,a){var r=parseInt(e);if(!isNaN(r)&&r>U.FLAG){W(t,n,a).forEach((function(e){t[e.row][e.cell]=U.FLAG}));var o=W(t,n,a,U.FLAG),i=W(t,n,a,U.MINE);o.length>0&&o.length+i.length===r&&o.forEach((function(e){t[e.row][e.cell]=U.MINE})),i.length>0&&i.length===r&&o.length>0&&o.forEach((function(e){t[e.row][e.cell]=U.SAFE_TO_OPEN}))}}))})),t.forEach((function(e,n){return e.forEach((function(e,a){var r=parseInt(e);if(!isNaN(r)&&r>U.FLAG){var o=W(t,n,a,U.FLAG),i=W(t,n,a,U.MINE);i.length>0&&i.length===r&&o.length>0&&o.forEach((function(e){t[e.row][e.cell]=U.SAFE_TO_OPEN}))}}))})),t}(n.state.matrix),a=!1;if(t.forEach((function(e,t){e.forEach((function(e,r){e!==n.state.matrix[t][r]&&(a=!0)}))})),a)return void n.setState({matrix:t});if(n.state.autobotEnabled&&t.every((function(e){return e.every((function(e){return isNaN(e)}))})))return void n.open(Math.round(t[0].length/2),Math.round(t.length/2));if(!n.state.autobotEnabled)return void n.setState({helpRequired:!0});if(n.state.matrix.reduce((function(e,t){return e+t.filter((function(e){return isNaN(e)})).length}),0)<t.length*t[0].length*n.state.autobotStopPercent/100)return void n.setState({autobotEnabled:!1});for(var r=null,o=0,i=0;i<t.length;i++)for(var s=0;s<t[i].length;s++)if(isNaN(t[i][s])){var c=W(t,i,s,U.MINE,!1);c>o&&(o=c,r={row:i,cell:s})}if(r)return void n.open(r.cell,r.row);for(var l=0;l<t.length;l++){for(var u=0;u<t[l].length;u++)if(t[l][u]===U.FLAG){r={row:l,cell:u};break}if(r)break}if(r)return void n.open(r.cell,r.row);n.setState({helpRequired:!0})}},n.state={matrix:[],connection:new C("wss://hometask.eg1236.com/game1/",n.resolver),started:!1,loose:!1,helpRequired:!0,autobotEnabled:!1,password:null,connected:!1},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){this.state.started&&this.state.matrix.length>0&&(this.state.autobotEnabled||!this.state.helpRequired)&&this.step()}},{key:"render",value:function(){var e=this.state.matrix.reduce((function(e,t){return e+t.filter((function(e){return e===U.MINE})).length}),0),t=this.state.matrix.some((function(e){return e.some((function(e){return e===U.REAL_MINE}))}))&&!this.state.matrix.every((function(e){return e.every((function(e){return e===U.REAL_MINE||!isNaN(e)}))}));return r.a.createElement("div",{className:"App"},r.a.createElement(M,{password:this.state.password}),r.a.createElement("hr",null),r.a.createElement(E,{startGame:this.startGame,loose:t,restartGame:this.restartGame}),r.a.createElement("hr",null),this.state.started?r.a.createElement(r.a.Fragment,null,r.a.createElement(I,{minesCount:e}),r.a.createElement(D,{helpRequired:this.state.helpRequired})):null,r.a.createElement(x,{matrix:this.state.matrix,open:this.open,setFlag:this.setFlag}))}}]),t}(r.a.Component);Y.displayName="App";var J=Y;i.a.render(r.a.createElement(J,null),document.getElementById("root"))},7:function(e,t,n){e.exports={cell:"styles_cell__XNJeH",safe:"styles_safe__2yXuU",flag:"styles_flag__1Y40j",mine:"styles_mine__MLcNf"}},9:function(e,t,n){e.exports={desk:"styles_desk__DUIO6",row:"styles_row__DtQBb"}}},[[15,1,2]]]);
//# sourceMappingURL=main.8558a519.chunk.js.map